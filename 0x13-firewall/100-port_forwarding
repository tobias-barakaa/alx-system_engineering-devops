#!/bin/bash

# Check if ufw is installed
if ! command -v ufw &> /dev/null; then
    echo "ufw is not installed. Installing ufw..."
    sudo apt-get update
    sudo apt-get install -y ufw
fi

# Enable ufw if not already enabled
if ! sudo ufw status | grep -q "Status: active"; then
    echo "Enabling ufw..."
    sudo ufw enable
fi

# Check if the port forwarding rule already exists
if sudo ufw status | grep -q "8080/tcp -> 80/tcp"; then
    echo "Port forwarding rule already exists. No changes made."
else
    echo "Configuring port forwarding from 8080 to 80..."
    # Add the port forwarding rule
    echo "*nat
:PREROUTING ACCEPT [0:0]
-A PREROUTING -p tcp --dport 8080 -j REDIRECT --to-port 80
COMMIT" | sudo tee -a /etc/ufw/before.rules > /dev/null
    # Reload ufw to apply changes
    sudo ufw reload
    echo "Port forwarding configured successfully."
fi
